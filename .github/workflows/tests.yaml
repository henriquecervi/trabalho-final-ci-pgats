name: "Testes UnitÃ¡rios do Trabalho Final CI"

on:
  push:
  workflow_dispatch:

permissions:
  checks: write
  contents: read

jobs:
  unit-tests:
    runs-on: ubuntu-24.04

    steps:
      - name: ğŸ“¥ Fazendo checkout do projeto para o runner
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Instalando Node.js v22
        uses: actions/setup-node@v4
        with:
          node-version: 22

      - name: ğŸ“¦ Instalando Yarn
        run: npm install -g yarn

      - name: âš¡ Instalando DependÃªncias
        run: yarn

      - name: ğŸ§ª Executando Testes UnitÃ¡rios
        run: |
          mkdir -p test-results
          yarn unit-tests --reporter xunit --reporter-options output=test-results/results.xml

      - name: âœ… Resumo dos Testes
        if: success()
        run: |
          echo "## ğŸ‰ Testes Executados com Sucesso! âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“Š Status dos Testes:" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… **Status**: Todos os testes passaram!" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ§ª **Framework**: Mocha" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸŸ¢ **Node.js**: v22" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“¦ **Gerenciador**: Yarn" >> $GITHUB_STEP_SUMMARY

      - name: âŒ Resumo dos Testes (Falha)
        if: failure()
        run: |
          echo "## ğŸš¨ Alguns Testes Falharam! âŒ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“Š Status dos Testes:" >> $GITHUB_STEP_SUMMARY
          echo "- âŒ **Status**: Testes com falha!" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ§ª **Framework**: Mocha" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸŸ¢ **Node.js**: v22" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“¦ **Gerenciador**: Yarn" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ” **Verifique os logs acima para mais detalhes.**"

      - name: ğŸ“Š Publicando RelatÃ³rio JUnit de ExecuÃ§Ã£o dos Testes
        uses: dorny/test-reporter@v1
        if: ${{ !cancelled() }}
        with:
          name: ğŸ“‹ Unit Tests Results
          path: test-results/results.xml
          reporter: java-junit
          token: ${{ secrets.GITHUB_TOKEN }}
